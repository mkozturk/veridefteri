<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hazel Kavili">
<meta name="dcterms.date" content="2018-03-03">

<title>Veri Defteri - Tidyverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<link href="../../../../../img/veridefteri_ikon.png" rel="icon" type="image/png">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Veri Defteri</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../../about.html" rel="" target="">
 <span class="menu-text">Hakkımızda</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/veridefteri" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tidyverse</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Veri önişleme</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Hazel Kavili </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 3, 2018</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>Veri bilimiyle uğraşan birçok insanın karşısında satırlar ve sütunlardan oluşan tablolar mevcut. Bu tabloları bazen API’lar, bazen Excel, csv, txt dosyaları, bazen de veri tabanları sayesinde elde ediyoruz (tabi sadece bunlarla da sınırlı değil). Bunlar kimi zaman düzenli, ama çoğu zaman düzenleme (temizlik) isteyen tablolar. Tidyverse de burada devreye giriyor: bize düzenlemeleri, görselleştirmeleri, modellemeleri kolay bir şekilde yapabilmemizi sağlayan, R’ın birçok paketini içinde bulunduran büyükçe bir paket. Hepsiyle beraber ve en önemlisi Tidyverse bize bir iş akışı (workflow) sunar. Veri bilimi ile uğraşanların sistematik bir şekilde ilerlemesine, işlemler arasında bağlantıların kolay kurulup anlaşılmasına yardımcı olur. Aşağıdaki şemada, tidyverse’ün sağladığı akışı ve kullanabileceğiniz bazı paketleri görebilirsiniz:</p>
<p><img src="ee179-workflow3.png" class="img-fluid" width="800"></p>
<p>Yukarıda bahsedilen tabloları, R dünyasında <em>data frame</em> veya şu anda yaygın halde kullanılan <em>tibble</em> olarak adlandırıyoruz.</p>
<p>Satırlarda gözlemler, sütunlarda değişkenler olacak şekilde aşağıda düzenli, örnek bir data frame var:</p>
<p><img src="be026-dataframe.png" class="img-fluid" width="800"></p>
<p>Son yıllarda hem okuduklarımdan hem gittiğim konferanslardan hem de içinde bulunduğum <a href="https://rladies.org">R-Ladies</a> topluluğunda veri bilimi eğitimi veren arkadaşlarımızdan edindiğim bilgiler doğrultusunda, bu işe yeni başlayanlara bu alanı sevdirmek için tidyverse yöntemleriyle yazılarıma devam edeceğim. Nedenlerine sevgili <a href="https://github.com/mine-cetinkaya-rundel/2017-07-05-teach-ds-to-new-user">Mine Çetintaka-Rundell</a> useR!2017’deki sunumunda çeşitli örneklerle değinmişti. Aşağıdaki örnekleri kendi çalışma alanınızda da deneyebilirsiniz, <em>mtcars</em> R’ın içinde hazır bir veri seti, arabaların benzin tüketimleriyle ve bazı fiziksel özellikleriyle ilgili. Bu iki örnek de aynı sonucu verecektir.</p>
İlk önce <code>install.packages(“tidyverse”)</code> ile paketi yükleyelim ve <code>library(tidyverse)</code> ile de paketi çalışır hale getirelim:
<pre class="r"><code>install.packages("tidyverse")</code></pre>
<pre class="r"><code>library(tidyverse)</code></pre>
Ardından <code>mtcars</code> veri setine şöyle bir bakalım:
<pre class="r"><code>head(mtcars)</code></pre>
<pre><code>##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
İlk önce <em>base</em> R işlemleriyle yeni bir değişken oluşturalım ve bu değişkenin ismi <code>transmission</code> olsun. Bunu da <code>am</code> değişkenindeki 1 ve 0’lara göre yapalım: 0 olursa “automatic”, 1 olursa “manual” olsun.
<pre class="r"><code>mtcars$transmission[mtcars$am == 0] = "automatic"
mtcars$transmission[mtcars$am == 1] = "manual"</code></pre>
<p>Burada <code>$</code> işareti iki şekilde kullanılmış: sizin veri setinizden bir değişken seçmenize (subset yani alt kümeleme gibi düşünebilirsiniz) ve veri setinizde bir değişken oluşturmada. Bunu ayırt etmesi kolay değil.</p>
Aynı işlemi bir de tidyverse ile yapalım. <code>mutate</code> ve <code>case_when</code> kullanarak:
<pre class="r"><code>mtcars &lt;- mtcars %&gt;%
  mutate(
    transmission = 
      case_when(
        am == 0 ~ "automatic",
        am == 1 ~ "manual"
      )
    )</code></pre>
<code>mutate</code> dönüştürmek demek. <code>case_when</code> ise sizi <code>if</code> ve <code>else if</code> yapılarını uzun uzun yazmaktan kurtarır. İkinci yazım şekli adım adım daha okunabilir, kolay yazılabilir ve takip edilebilir.
<section id="dplyra-giris" class="level3">
<h3 class="anchored" data-anchor-id="dplyra-giris">
dplyr’a giriş
</h3>
<p>dplyr, veri manipülasyonu işlemlerini yapabileceğiniz, birçok temel problemi çözen ve bunları aklıda kalıcı fiillerle yapan bir paket. <code>select</code>, <code>filter</code>, <code>muatate</code>, <code>group_by</code>, <code>arrange</code>, <code>summarise</code> bunlardan birkaçı. Ayrıntılı bilgiye <a href="http://dplyr.tidyverse.org">bu sayfadan</a> ulaşabilirsiniz.</p>
Bu bölümde size <em>movies</em> veri setini çalışma alanınıza indirip, okuyup, bir değişkene atadıktan sonra işlenmeye hazır hale getirmeyi anlatacağım. <em>movies</em> veri setini indirebileceğiniz <a href="https://www.dropbox.com/s/009shbt1l8kvq0e/movies.csv?dl=0">link burada</a>.
<pre class="r"><code>filmler &lt;- read.csv(file = "movies.csv" , header = TRUE, sep = ",") </code></pre>
<p><code>read.csv()</code>, <code>read.xlsx()</code>, <code>read.table()</code> gibi fonksiyonlar verinizi çalışma alanınıza almanızı sağlar. <em>&lt;-</em> operatörü, atama operatörüdür. Burada, veri setimizi okuyup, atama operatörü ile <em>filmler</em> isimli bir değişkene atamış olduk.</p>
Şimdi veri setimize bir bakalım. <code>head()</code> fonksiyonu bize veri setimizin ilk 6 gözlemini, <code>tail()</code> fonksiyonu son 6 gözlemini veriyor. Ancak <em>n</em> argümanını değiştirerek istediğiniz kadar gözlemi getirebilirsiniz:
<pre class="r"><code>head(filmler, n = 5)</code></pre>
<pre><code>##       director_name duration     actor_2_name     gross    actor_1_name
## 1     James Cameron      178 Joel David Moore 760505847     CCH Pounder
## 2    Gore Verbinski      169    Orlando Bloom 309404152     Johnny Depp
## 3        Sam Mendes      148     Rory Kinnear 200074175 Christoph Waltz
## 4 Christopher Nolan      164   Christian Bale 448130642       Tom Hardy
## 5    Andrew Stanton      132  Samantha Morton  73058679    Daryl Sabara
##                                 movie_title         actor_3_name language
## 1                                   Avatar             Wes Studi  English
## 2 Pirates of the Caribbean: At World's End        Jack Davenport  English
## 3                                  Spectre      Stephanie Sigman  English
## 4                    The Dark Knight Rises  Joseph Gordon-Levitt  English
## 5                              John Carter          Polly Walker  English
##   country    budget title_year imdb_score genres
## 1     USA 237000000       2009        7.9 Action
## 2     USA 300000000       2007        7.1 Action
## 3      UK 245000000       2015        6.8 Action
## 4     USA 250000000       2012        8.5 Action
## 5     USA 263700000       2012        6.6 Action</code></pre>
<pre class="r"><code>tail(filmler, n = 3)</code></pre>
<pre><code>##         director_name duration       actor_2_name gross actor_1_name
## 3704 Neill Dela Llana       80    Edgar Tancangco 70071  Ian Gamazon
## 3705     Edward Burns       95 Caitlin FitzGerald  4584  Kerry Bishé
## 3706         Jon Gunn       90   Brian Herzlinger 85222  John August
##             movie_title    actor_3_name language     country budget
## 3704            Cavite        Quynn Ton  English Philippines   7000
## 3705         Newlyweds  Daniella Pineda  English         USA   9000
## 3706 My Date with Drew         Jon Gunn  English         USA   1100
##      title_year imdb_score      genres
## 3704       2005        6.3    Thriller
## 3705       2011        6.4      Comedy
## 3706       2004        6.6 Documentary</code></pre>
<p><code>str(filmler)</code>, <code>summary(filmler)</code> ve <code>dim(filmler)</code> fonksiyonlarını da çalıştırıp veri setinizi daha yakından tanıyabilirsiniz. <code>str</code> structure (yapı), <code>summary</code> özet, <code>dim</code> dimension (boyut) demektir.</p>
<p>Şimdi gelelim dplyr’ın nimetlerine.</p>
Örneğin veri setinizdeki 13 değişkenle iş yapmak yerine, sadece bazı değişkenleri <em>seçmek</em> istiyorsunuz. Kullanacağınız fonksiyon: <code>select()</code>
<pre class="r"><code>filmler_ulkeler &lt;- filmler %&gt;% select(country, budget, imdb_score) %&gt;% head(n=3)
filmler_ulkeler</code></pre>
<pre><code>##   country    budget imdb_score
## 1     USA 237000000        7.9
## 2     USA 300000000        7.1
## 3      UK 245000000        6.8</code></pre>
Seçmek istediğiniz kolonların sayı sırasını biliyorsanız sayı değerlerini yazabilir, setinizde istemediğiniz değişkeni önüne eksi (-) yazarak çıkarabilirsiniz:
<pre class="r"><code>filmler_ulkeler &lt;- filmler %&gt;% select(2:6, -4) %&gt;% head(n=3)
filmler_ulkeler</code></pre>
<pre><code>##   duration     actor_2_name    actor_1_name
## 1      178 Joel David Moore     CCH Pounder
## 2      169    Orlando Bloom     Johnny Depp
## 3      148     Rory Kinnear Christoph Waltz
##                                 movie_title
## 1                                   Avatar 
## 2 Pirates of the Caribbean: At World's End 
## 3                                  Spectre </code></pre>
<p>Burada yeni bir operatörle karşı karşıyayız: <em>%&gt;%</em> Buna <em>pipe</em> operatörü deniyor, biz de <em>zincir</em> operatörü demeyi tercih ediyoruz. Bu operatör soldakinin çıktısını, sağdakine girdi olarak veriyor. Örneğin yukarıda <em>filmler</em> veri setini alıyor, <em>country, budget, imdb_score</em> değişkenlerini seçiyor. Ve yeni bir değişkene, <em>filmler_ülkeler</em>, değişkenine atama yapıyor.</p>
Pekiyi gözlemlerin içinden bazılarını <em>filtrelemek</em> istiyorsanız, <em>örneğin Christopher Nolan’ın imdb puanı 7’den büyük olan filmlerini</em> görmek istiyorsunuz, bu durumda kullanacağınız fonksiyon: <code>filter()</code>:
<pre class="r"><code>filmler_puanlar &lt;- filmler %&gt;% filter(imdb_score &gt; 7, director_name == "Christopher Nolan")

filmler_puanlar</code></pre>
<pre><code>##       director_name duration   actor_2_name     gross        actor_1_name
## 1 Christopher Nolan      164 Christian Bale 448130642           Tom Hardy
## 2 Christopher Nolan      152   Heath Ledger 533316061      Christian Bale
## 3 Christopher Nolan      169  Anne Hathaway 187991439 Matthew McConaughey
## 4 Christopher Nolan      148      Tom Hardy 292568851   Leonardo DiCaprio
## 5 Christopher Nolan      128    Liam Neeson 205343774      Christian Bale
## 6 Christopher Nolan      118  Maura Tierney  67263182           Al Pacino
## 7 Christopher Nolan      130   Hugh Jackman  53082743      Christian Bale
## 8 Christopher Nolan      113  Thomas Lennon  25530884       Callum Rennie
##              movie_title         actor_3_name language country    budget
## 1 The Dark Knight Rises  Joseph Gordon-Levitt  English     USA 250000000
## 2       The Dark Knight        Morgan Freeman  English     USA 185000000
## 3          Interstellar         Mackenzie Foy  English     USA 165000000
## 4             Inception  Joseph Gordon-Levitt  English     USA 160000000
## 5         Batman Begins        Morgan Freeman  English     USA 150000000
## 6              Insomnia          Crystal Lowe  English     USA  46000000
## 7          The Prestige    Scarlett Johansson  English     USA  40000000
## 8               Memento             Jorja Fox  English     USA   9000000
##   title_year imdb_score    genres
## 1       2012        8.5    Action
## 2       2008        9.0    Action
## 3       2014        8.6 Adventure
## 4       2010        8.8    Action
## 5       2005        8.3    Action
## 6       2002        7.2     Drama
## 7       2006        8.5     Drama
## 8       2000        8.5   Mystery</code></pre>
Filter fonksiyonu ile tüm mantıksal operatörleri kullanabilirsiniz. Öğrendiğimiz iki fonksiyonu birleştirmek gerekirse:
<pre class="r"><code>filmler_UK &lt;- filmler %&gt;% select(country, title_year, imdb_score) %&gt;% 
  filter (imdb_score &gt;= 6 &amp; country == "UK") 

head(filmler_UK)</code></pre>
<pre><code>##   country title_year imdb_score
## 1      UK       2015        6.8
## 2      UK       2009        7.5
## 3      UK       2008        6.7
## 4      UK       2012        7.8
## 5      UK       2016        7.8
## 6      UK       2007        7.5</code></pre>
Bu yazıdaki son fonksiyon da gözlemlerinizi, seçeceğiniz değişkene göre sıralamak istediğiniz zaman kullanacağınız fonksiyon: <code>arrange()</code>
<pre class="r"><code>filmler_butce &lt;- filmler %&gt;% select(movie_title, imdb_score, budget) %&gt;% arrange(budget)

head(filmler_butce)</code></pre>
<pre><code>##          movie_title imdb_score budget
## 1         Tarnation         7.2    218
## 2 My Date with Drew         6.6   1100
## 3            Primer         7.0   7000
## 4            Cavite         6.3   7000
## 5         Newlyweds         6.4   9000
## 6    Pink Flamingos         6.1  10000</code></pre>
Eğer gözlemleri bir (ya da daha fazla) değişkene göre artan sıralamak istiyorsanız fazladan bir şey yazmanız gerekmiyor, ama azalan sıralamak istiyorsanız:
<pre class="r"><code>filmler_butce &lt;- filmler %&gt;% select(movie_title, imdb_score, budget) %&gt;% arrange(desc(budget))

head(filmler_butce)</code></pre>
<pre><code>##                                 movie_title imdb_score    budget
## 1                                    Kites         6.0 600000000
## 2  The Messenger: The Story of Joan of Arc         6.4 390000000
## 3 Pirates of the Caribbean: At World's End         7.1 300000000
## 4                              John Carter         6.6 263700000
## 5                                  Tangled         7.8 260000000
## 6                             Spider-Man 3         6.2 258000000</code></pre>
<p>Bir sonraki yazıda <code>mutate()</code>, <code>group_by()</code> ve <code>summarise()</code> fonksiyonlarını aynı veri seti üzerinden anlatacağım.</p>
</section>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>